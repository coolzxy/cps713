Hello Professor or TAs,

To compile the assignment simply type make or run the following:

gcc mode-of-operations.c




Lab Questions and Answers:
==========================

NOTE: As discussed with TAs, since a block is 8-bits / 1 byte long we cannot implement any padding without losing data / precision of plaintext. As a result, padding has been omitted in this lab and Hill Cipher implementation (parts 2(b)(i) and 2(b)(ii))

NOTE: All ciphertext output contains a 9-byte header that describes the encrypted contents:

0                2        3        4                                8        9
+----------------+--------+--------+--------------------------------+--------+
| "HC" magic str | Flags  |   IV   |         IV Table Index         |  Ver.  |
|    2 bytes     | 1 byte | 1 byte |     4 bytes (unsigned int)     | 1 byte |
+----------------+--------+--------+--------------------------------+--------+

1. "HC" magic str identifies file as an encrypted file
2. Flags contains the encryption block mode and IV source:
   - 1XXXXXX = IV index is specified and IV must be looked up in public table
   - XXXXX00 = Block mode is ECB
   - XXXXX01 = Block mode is CBC
   - XXXXX10 = Block mode is CFB
3. IV is the IV value used in CBC or CFG but encrypted with Hill Cipher in ECB mode
4. IV Table Index is the location of the IV value in the generated nonce IV table.
5. Version specifies what implementation version this encrypted file is.


1.a. - Run Program! Example output tested below:
------------------------------------------------

➜  lab1b git:(master) ✗ ./a.out message1.txt
Are you (1) encrypting or (2) decrypting?

Enter choice: 1
Available Modes of Operation:
(1) ECB   (2) CBC   (3) CFB

Enter choice: 1
Where should we save the output / resulting bytes? Type "none" to not save to a file

Enter filename: message1.enc
Original Plaintext:   "Dear Alice,

I regret to inform you I cannot attend the ball.

Signed,
Bob"
Encrypted Ciphertext: 0x48 0x43 0x00 0x00 0x00 0x00 0x00 0x00 0x01 0xCC 0xAF 0xA3 0x96 0x60 0xC3 0xB4 0xBB 0xA5 0xAF 0x74 0x1E 0x1E 0xDB 0x60 0x96 0xAF 0xA9 0x96 0xAF 0x9C 0x60 0x9C 0xB1 0x60 0xBB 0xB2 0xAA 0xB1 0x96 0xB7 0x60 0x8B 0xB1 0x9F 0x60 0xDB 0x60 0xA5 0xA3 0xB2 0xB2 0xB1 0x9C 0x60 0xA3 0x9C 0x9C 0xAF 0xB2 0xAC 0x60 0x9C 0xB8 0xAF 0x60 0xA6 0xA3 0xB4 0xB4 0x72 0x1E 0x1E 0xF5 0xBB 0xA9 0xB2 0xAF 0xAC 0x74 0x1E 0xC6 0xB1 0xA6

➜  lab1b git:(master) ✗ ./a.out message1.enc
Are you (1) encrypting or (2) decrypting?

Enter choice: 2
Where should we save the output / resulting bytes? Type "none" to not save to a file

Enter filename: none
Detected Hill Cipher implementation version 1
Detected ciphertext in ECB mode...
Original Ciphertext:  0x48 0x43 0x00 0x00 0x00 0x00 0x00 0x00 0x01 0xCC 0xAF 0xA3 0x96 0x60 0xC3 0xB4 0xBB 0xA5 0xAF 0x74 0x1E 0x1E 0xDB 0x60 0x96 0xAF 0xA9 0x96 0xAF 0x9C 0x60 0x9C 0xB1 0x60 0xBB 0xB2 0xAA 0xB1 0x96 0xB7 0x60 0x8B 0xB1 0x9F 0x60 0xDB 0x60 0xA5 0xA3 0xB2 0xB2 0xB1 0x9C 0x60 0xA3 0x9C 0x9C 0xAF 0xB2 0xAC 0x60 0x9C 0xB8 0xAF 0x60 0xA6 0xA3 0xB4 0xB4 0x72 0x1E 0x1E 0xF5 0xBB 0xA9 0xB2 0xAF 0xAC 0x74 0x1E 0xC6 0xB1 0xA6
Decrypted Plaintext:  0x44 0x65 0x61 0x72 0x20 0x41 0x6C 0x69 0x63 0x65 0x2C 0x0A 0x0A 0x49 0x20 0x72 0x65 0x67 0x72 0x65 0x74 0x20 0x74 0x6F 0x20 0x69 0x6E 0x66 0x6F 0x72 0x6D 0x20 0x79 0x6F 0x75 0x20 0x49 0x20 0x63 0x61 0x6E 0x6E 0x6F 0x74 0x20 0x61 0x74 0x74 0x65 0x6E 0x64 0x20 0x74 0x68 0x65 0x20 0x62 0x61 0x6C 0x6C 0x2E 0x0A 0x0A 0x53 0x69 0x67 0x6E 0x65 0x64 0x2C 0x0A 0x42 0x6F 0x62
Decrypted Plaintext:  "Dear Alice,

I regret to inform you I cannot attend the ball.

Signed,
Bob"




1.b. The resulting ciphertexts for "Dear Alice,\n\n" are exactly the same:
--------------------------------------------------------------------------

NOTE: For simplicity, the Hill Cipher header has been removed in this section when discussing encrypted bytes.

➜  lab1b git:(master) ✗ cat message1.txt
Dear Alice,

I regret to inform you I cannot attend the ball.

Signed,
Bob
➜  lab1b git:(master) ✗ cat message2.txt
Dear Alice,

Oh, furthermore, I suspect our communications may be compromised by Trudy.

Signed,
Bob



### 1.b.i. ###

➜  lab1b git:(master) ✗ hexdump message1.enc
0000000 cc af a3 96 60 c3 b4 bb a5 af 74 1e 1e ...
➜  lab1b git:(master) ✗ hexdump message2.enc
0000000 cc af a3 96 60 c3 b4 bb a5 af 74 1e 1e ...



### 1.b.ii. ###

An attacker can simply observe/record previous ciphertexts, know the boundaries of the message, and cut&paste attack any field in the message! He or she can reverse transactions, send money from anyone to anyone if he or she has seen them previously, with any amount previously observed/used.

A message that sends $10 from Alice (acct 1) to Bob (acct 2) [NOTE using "0" for padding]:
Original Plaintext:   "Alice00000000001Bob0000000000000210"
Encrypted Ciphertext: 0xC3 0xB4 0xBB 0xA5 0xAF 0x50 0x50 0x50 0x50 0x50 0x50 0x50 0x50 0x50 0x50 0x53 0xC6 0xB1 0xA6 0x50 0x50 0x50 0x50 0x50 0x50 0x50 0x50 0x50 0x50 0x50 0x50 0x50 0x56 0x53 0x50

Attack modifies message to reverse transaction:
Modified Ciphertext: 0xC6 0xB1 0xA6 0x50 0x50 0x50 0x50 0x50 0x50 0x50 0x50 0x50 0x50 0x50 0x50 0x50 0x56 0xC3 0xB4 0xBB 0xA5 0xAF 0x50 0x50 0x50 0x50 0x50 0x50 0x50 0x50 0x50 0x50 0x53 0x53 0x50
Decrypted Plaintext: "Bob00000000000002Alice0000000000110"



### 1.b.iii. ###

Plaintext Samples (binary & hex shown):
     Sample 1:   Sample 2:   Sample 3:   Sample 4:   Sample 5:
1st  1111 1111   0000 0000   1010 1010   1011 1010   0101 0101
2nd  1111 1110   0000 0001   1010 0010   1010 1010   1101 0101
     0xFF and    0x00 and    0xAA and    0xBA and    0x55 and
     0xFE        0x01        0xA2        0xAA        0xD5

     Sample 6:   Sample 7:   Sample 8:   Sample 9:   Sample 10:
1st  0000 1111   1111 0000   0011 0011   1100 1100   1110 1110
2nd  0000 0111   1111 0001   0001 0011   1110 1100   1100 1110
     0x0F and    0xF0 and    0x33 and    0xCC and    0xEE and
     0x07        0xF1        0x13        0xEC        0xCE

Corresponding Ciphertext Samples (binary & hex shown):
     Sample 1:   Sample 2:   Sample 3:   Sample 4:   Sample 5:
1st  0000 0001   0000 0000   1111 1110   1100 1110   1111 1111
2nd  0000 0010   0000 0011   1110 0110   1111 1110   0111 1111
     0x01 and    0x00 and    0xFE and    0xCE and    0xFF and
     0x02        0x03        0xE6        0xFE        0x7F

     Sample 6:   Sample 7:   Sample 8:   Sample 9:   Sample 10:
1st  0001 0001   0001 0000   0101 0101   0101 0100   0011 0010
2nd  0000 1001   0001 0011   0011 0101   0011 0100   0101 0010
     0x11 and    0x10 and    0x55 and    0x54 and    0x32 and
     0x09        0x13        0x35        0x34        0x52

After encryption, it appears each pair differ by 2 bits instead of just 1 bit.




2.a - Run Program in CBC mode! Example output tested below:
-----------------------------------------------------------

➜  lab1b git:(master) ✗ ./a.out message1.txt
Are you (1) encrypting or (2) decrypting?

Enter choice: 1
Available Modes of Operation:
(1) ECB   (2) CBC   (3) CFB

Enter choice: 2
Do you want to (1) randomly select an IV or (2) use a public nonce IV table?

Enter choice: 1
Enter in desired IV value in binary (eg 10101100)

Enter IV: 10101111
Where should we save the output / resulting bytes? Type "none" to not save to a file

Enter filename: message1iv.cbc
Original Plaintext:   "Dear Alice,

I regret to inform you I cannot attend the ball.

Signed,
Bob"
Encrypted Ciphertext: 0x48 0x43 0x01 0xF1 0x00 0x00 0x00 0x00 0x01 0x3D 0xE8 0x9B 0x3B 0x2D 0xB4 0x68 0x03 0xA0 0x4F 0xA5 0xF1 0x0D 0xCC 0x34 0xCA 0xF1 0xBA 0x58 0x47 0x55 0x9F 0x3D 0xF6 0x7A 0x35 0xED 0x9D 0x16 0xAC 0x43 0xA5 0x64 0x1D 0xB8 0xA8 0x23 0x05 0xAA 0x5D 0x55 0x4D 0x66 0x36 0x3A 0xED 0xAB 0x61 0x0C 0xA6 0x46 0xAA 0x62 0x1E 0x8D 0xF7 0xBF 0x62 0x12 0x82 0xF4 0x02 0x18 0xDD 0xDC 0xCD 0xE5 0x80 0x2C 0x00 0x1E 0xE4 0x9D 0x01
➜  lab1b git:(master) ✗ ./a.out message1.txt
Are you (1) encrypting or (2) decrypting?

Enter choice: 1
Available Modes of Operation:
(1) ECB   (2) CBC   (3) CFB

Enter choice: 2
Do you want to (1) randomly select an IV or (2) use a public nonce IV table?

Enter choice: 2
Where should we save the output / resulting bytes? Type "none" to not save to a file

Enter filename: message1ivtable.cbc
Original Plaintext:   "Dear Alice,

I regret to inform you I cannot attend the ball.

Signed,
Bob"
Encrypted Ciphertext: 0x48 0x43 0x81 0x00 0x07 0x00 0x00 0x00 0x01 0x16 0x95 0x1C 0xB2 0xB6 0x19 0x9F 0x1A 0x8B 0x32 0x22 0x78 0x96 0x61 0xC3 0xD3 0xDA 0xC7 0xDF 0xCE 0xCE 0x32 0xCA 0xEF 0x51 0x48 0x6A 0x14 0x8D 0x01 0xB4 0xBC 0x4F 0x60 0x3F 0x21 0xB8 0xA8 0x5D 0x44 0x7E 0x30 0xE1 0xBF 0xA1 0x40 0x5C 0x78 0x27 0xDB 0xC1 0x23 0xF9 0xB3 0x7A 0xEE 0x94 0x1F 0x95 0x0B 0x6F 0xAF 0xEF 0xC4 0xF7 0xB0 0x62 0x09 0xB7 0xAD 0xE9 0xFD 0xB6 0x7C

➜  lab1b git:(master) ✗ ./a.out message1iv.cbc
Are you (1) encrypting or (2) decrypting?

Enter choice: 2
Where should we save the output / resulting bytes? Type "none" to not save to a file

Enter filename: none
Detected Hill Cipher implementation version 1
Detected ciphertext in CBC mode...
Detected HC-ECB encrypted IV. Decrypted to 0xAF
Original Ciphertext:  0x48 0x43 0x01 0xF1 0x00 0x00 0x00 0x00 0x01 0x3D 0xE8 0x9B 0x3B 0x2D 0xB4 0x68 0x03 0xA0 0x4F 0xA5 0xF1 0x0D 0xCC 0x34 0xCA 0xF1 0xBA 0x58 0x47 0x55 0x9F 0x3D 0xF6 0x7A 0x35 0xED 0x9D 0x16 0xAC 0x43 0xA5 0x64 0x1D 0xB8 0xA8 0x23 0x05 0xAA 0x5D 0x55 0x4D 0x66 0x36 0x3A 0xED 0xAB 0x61 0x0C 0xA6 0x46 0xAA 0x62 0x1E 0x8D 0xF7 0xBF 0x62 0x12 0x82 0xF4 0x02 0x18 0xDD 0xDC 0xCD 0xE5 0x80 0x2C 0x00 0x1E 0xE4 0x9D 0x01
Decrypted Plaintext:  0x44 0x65 0x61 0x72 0x20 0x41 0x6C 0x69 0x63 0x65 0x2C 0x0A 0x0A 0x49 0x20 0x72 0x65 0x67 0x72 0x65 0x74 0x20 0x74 0x6F 0x20 0x69 0x6E 0x66 0x6F 0x72 0x6D 0x20 0x79 0x6F 0x75 0x20 0x49 0x20 0x63 0x61 0x6E 0x6E 0x6F 0x74 0x20 0x61 0x74 0x74 0x65 0x6E 0x64 0x20 0x74 0x68 0x65 0x20 0x62 0x61 0x6C 0x6C 0x2E 0x0A 0x0A 0x53 0x69 0x67 0x6E 0x65 0x64 0x2C 0x0A 0x42 0x6F 0x62
Decrypted Plaintext:  "Dear Alice,

I regret to inform you I cannot attend the ball.

Signed,
Bob"
➜  lab1b git:(master) ✗ ./a.out message1ivtable.cbc
Are you (1) encrypting or (2) decrypting?

Enter choice: 2
Where should we save the output / resulting bytes? Type "none" to not save to a file

Enter filename: none
Detected Hill Cipher implementation version 1
Detected ciphertext in CBC mode...
Detected IV index. Looking up IV in nonce table...
IV value is 0xB6
Original Ciphertext:  0x48 0x43 0x81 0x00 0x07 0x00 0x00 0x00 0x01 0x16 0x95 0x1C 0xB2 0xB6 0x19 0x9F 0x1A 0x8B 0x32 0x22 0x78 0x96 0x61 0xC3 0xD3 0xDA 0xC7 0xDF 0xCE 0xCE 0x32 0xCA 0xEF 0x51 0x48 0x6A 0x14 0x8D 0x01 0xB4 0xBC 0x4F 0x60 0x3F 0x21 0xB8 0xA8 0x5D 0x44 0x7E 0x30 0xE1 0xBF 0xA1 0x40 0x5C 0x78 0x27 0xDB 0xC1 0x23 0xF9 0xB3 0x7A 0xEE 0x94 0x1F 0x95 0x0B 0x6F 0xAF 0xEF 0xC4 0xF7 0xB0 0x62 0x09 0xB7 0xAD 0xE9 0xFD 0xB6 0x7C
Decrypted Plaintext:  0x44 0x65 0x61 0x72 0x20 0x41 0x6C 0x69 0x63 0x65 0x2C 0x0A 0x0A 0x49 0x20 0x72 0x65 0x67 0x72 0x65 0x74 0x20 0x74 0x6F 0x20 0x69 0x6E 0x66 0x6F 0x72 0x6D 0x20 0x79 0x6F 0x75 0x20 0x49 0x20 0x63 0x61 0x6E 0x6E 0x6F 0x74 0x20 0x61 0x74 0x74 0x65 0x6E 0x64 0x20 0x74 0x68 0x65 0x20 0x62 0x61 0x6C 0x6C 0x2E 0x0A 0x0A 0x53 0x69 0x67 0x6E 0x65 0x64 0x2C 0x0A 0x42 0x6F 0x62
Decrypted Plaintext:  "Dear Alice,

I regret to inform you I cannot attend the ball.

Signed,
Bob"